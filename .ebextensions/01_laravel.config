container_commands:
  01_create_storage_dirs:
    command: "mkdir -p storage/framework/sessions storage/framework/views storage/framework/cache/data storage/logs bootstrap/cache"
  02_set_permissions:
    command: "chmod -R 775 storage bootstrap/cache"
  03_set_ownership:
    command: "chown -R webapp:webapp storage bootstrap/cache"
  04_clear_config:
    command: "php artisan config:clear || true"
  05_clear_cache:
    command: "php artisan cache:clear || true"
  06_clear_view:
    command: "php artisan view:clear || true"
  07_storage_link:
    command: "php artisan storage:link || true"
  08_migrate:
    command: "php artisan migrate --force || true"
    leader_only: true
  09_optimize:
    command: "php artisan optimize || true"
  10_final_permissions:
    command: "chmod -R 775 storage bootstrap/cache && chown -R webapp:webapp storage bootstrap/cache"

option_settings:
  aws:elasticbeanstalk:container:php:phpini:
    document_root: /public
